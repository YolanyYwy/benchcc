# Tau2-CL å¿«é€Ÿå¼€å§‹æŒ‡å—

è¿™ä¸ªæŒ‡å—å°†å¸¦ä½ ä»é›¶å¼€å§‹ï¼Œä¸€æ­¥æ­¥å®ŒæˆæŒç»­å­¦ä¹ å®éªŒçš„æ•°æ®ç”Ÿæˆã€è®­ç»ƒå’Œæµ‹è¯•ã€‚

## ğŸ“‹ å‰ææ¡ä»¶

1. å·²å®‰è£… tau2-bench é¡¹ç›®ï¼š
```bash
pip install -e .
```

2. å·²é…ç½® API keysï¼ˆåœ¨ `.env` æ–‡ä»¶ä¸­ï¼‰

3. éªŒè¯å®‰è£…ï¼š
```bash
tau2 --help
# åº”è¯¥èƒ½çœ‹åˆ° cl-run, cl-analyze ç­‰å‘½ä»¤
```

---

## ğŸš€ æ–¹æ³•ä¸€ï¼šæœ€ç®€å•çš„æ–¹å¼ï¼ˆæ¨èæ–°æ‰‹ï¼‰

### æ­¥éª¤ 1ï¼šè¿è¡Œå¿«é€Ÿæµ‹è¯•ï¼ˆ5åˆ†é’Ÿï¼‰

ä½¿ç”¨æä¾›çš„å¿«é€Ÿå®éªŒè„šæœ¬ï¼Œä¸€é”®å®Œæˆæ‰€æœ‰æ­¥éª¤ï¼š

```bash
python scripts/quick_experiment.py quick-test --domain airline --num-tasks 10
```

è¿™ä¸ªå‘½ä»¤ä¼šè‡ªåŠ¨å®Œæˆï¼š
- âœ… éªŒè¯æ•°æ®æœ‰æ•ˆæ€§
- âœ… è¿è¡Œ10ä¸ªä»»åŠ¡çš„å®éªŒ
- âœ… åˆ†æå¹¶å±•ç¤ºç»“æœ

### æ­¥éª¤ 2ï¼šæŸ¥çœ‹ç»“æœ

```bash
# æŸ¥çœ‹å®éªŒç›®å½•
cd experiments/quick_test_airline

# æŸ¥çœ‹ç»“æœæ–‡ä»¶
cat results.json

# æŸ¥çœ‹å¯è§†åŒ–å›¾è¡¨ï¼ˆå¦‚æœç”Ÿæˆäº†çš„è¯ï¼‰
ls metrics/
```

**æ­å–œï¼** ä½ å·²ç»å®Œæˆäº†ç¬¬ä¸€ä¸ªæŒç»­å­¦ä¹ å®éªŒï¼

---

## ğŸ”¬ æ–¹æ³•äºŒï¼šæ‰‹åŠ¨è¿è¡Œï¼ˆç†è§£æ¯ä¸€æ­¥ï¼‰

### ç¬¬ä¸€æ­¥ï¼šéªŒè¯ç°æœ‰æ•°æ®

å…ˆæ£€æŸ¥ç°æœ‰çš„ä»»åŠ¡æ•°æ®æ˜¯å¦æœ‰æ•ˆï¼š

```bash
# éªŒè¯å•ä¸ªdomain
tau2 cl-validate-data data/tau2/domains/airline/tasks.json

# éªŒè¯æ‰€æœ‰domain
tau2 cl-validate-data data/tau2/domains/

# æŸ¥çœ‹æ•°æ®ç»Ÿè®¡
tau2 cl-data-requirements --domains airline retail telecom
```

**é¢„æœŸè¾“å‡ºï¼š**
```
âœ“ Validated 50 tasks from airline
âœ“ Validated 45 tasks from retail
âœ“ Validated 40 tasks from telecom

Data Requirements:
  airline: 50 tasks available
  retail: 45 tasks available
  telecom: 40 tasks available

Recommended minimum for CL experiments: 30 tasks per domain
```

### ç¬¬äºŒæ­¥ï¼šç”ŸæˆCLæ•°æ®åˆ’åˆ†

å°†ä»»åŠ¡åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼š

```bash
tau2 cl-generate-splits \
    --domains airline retail \
    --strategy sequential \
    --train-ratio 0.7 \
    --num-phases 3 \
    --output-dir data/tau2/cl_splits
```

**è¿™ä¼šç”Ÿæˆï¼š**
- `data/tau2/cl_splits/airline_cl_split.json`
- `data/tau2/cl_splits/retail_cl_split.json`
- `data/tau2/cl_splits/multi_domain_cl_split.json`

### ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œç¬¬ä¸€ä¸ªå®éªŒ

ç°åœ¨å¼€å§‹è®­ç»ƒï¼å…ˆè¿è¡Œä¸€ä¸ªå°å®éªŒæµ‹è¯•ï¼š

```bash
tau2 cl-run \
    --name my_first_experiment \
    --domains airline \
    --curriculum sequential \
    --agent-type icl_er \
    --agent-llm gpt-4o-mini \
    --user-llm gpt-4o-mini \
    --num-tasks 20 \
    --eval-frequency 5 \
    --output-dir ./experiments/my_first_experiment \
    --seed 42
```

**å‚æ•°è¯´æ˜ï¼š**
- `--name`: å®éªŒåç§°
- `--domains`: è¦ä½¿ç”¨çš„é¢†åŸŸ
- `--curriculum`: è¯¾ç¨‹ç­–ç•¥ï¼ˆsequential=é¡ºåºå­¦ä¹ ï¼Œinterleaved=äº¤é”™å­¦ä¹ ï¼‰
- `--agent-type`: Agentç±»å‹ï¼ˆicl_er=ç»éªŒå›æ”¾ï¼Œprompt_strategy=æç¤ºç­–ç•¥ï¼Œbaseline=åŸºçº¿ï¼‰
- `--num-tasks`: è®­ç»ƒä»»åŠ¡æ•°é‡
- `--eval-frequency`: æ¯Nä¸ªä»»åŠ¡è¯„ä¼°ä¸€æ¬¡

**å®éªŒè¿›è¡Œæ—¶ä½ ä¼šçœ‹åˆ°ï¼š**
```
[2025-12-03 10:30:00] Starting CL Experiment: my_first_experiment
[2025-12-03 10:30:01] Phase 1/1: airline (20 tasks)
[2025-12-03 10:30:05] Task 1/20 completed. Reward: 0.85
[2025-12-03 10:30:10] Task 2/20 completed. Reward: 0.92
...
[2025-12-03 10:35:00] Evaluation checkpoint at task 5
  Current accuracy: 0.87
  Memory buffer: 15 experiences
...
[2025-12-03 10:45:00] âœ“ Experiment completed!
  Results saved to: ./experiments/my_first_experiment/
```

### ç¬¬å››æ­¥ï¼šåˆ†æç»“æœ

```bash
tau2 cl-analyze ./experiments/my_first_experiment/results.json
```

**é¢„æœŸè¾“å‡ºï¼š**
```
============================================================
Continual Learning Experiment Analysis
============================================================
Experiment: my_first_experiment
Domains: ['airline']
Curriculum: SEQUENTIAL
Agent Type: ICL_ER

Metrics:
  Average Accuracy: 0.847
  Forgetting Rate: 0.123
  Forward Transfer: 0.056
  Backward Transfer: -0.089

Per-Domain Accuracy:
  airline: 0.847

Per-Domain Forgetting:
  airline: 0.123
============================================================
```

### ç¬¬äº”æ­¥ï¼šæŸ¥çœ‹è¯¦ç»†ç»“æœ

```bash
cd experiments/my_first_experiment

# æŸ¥çœ‹é…ç½®
cat config.json

# æŸ¥çœ‹å®Œæ•´ç»“æœ
cat results.json

# æŸ¥çœ‹ç”Ÿæˆçš„å›¾è¡¨
ls metrics/
# åº”è¯¥çœ‹åˆ°ï¼šaccuracy_curve.png, forgetting_matrix.png, performance_matrix.png
```

---

## ğŸ¯ æ–¹æ³•ä¸‰ï¼šè¿è¡Œå®Œæ•´å¯¹æ¯”å®éªŒ

å¦‚æœä½ æƒ³å¯¹æ¯”ä¸åŒçš„æ–¹æ³•ï¼Œä½¿ç”¨è¿™ä¸ªè„šæœ¬ï¼š

```bash
python scripts/quick_experiment.py full \
    --domains airline,retail \
    --num-tasks 50 \
    --curriculum sequential \
    --model gpt-4o-mini
```

è¿™ä¼šè‡ªåŠ¨è¿è¡Œ3ä¸ªå®éªŒå¹¶å¯¹æ¯”ï¼š
1. **ICL-ER**: å¸¦ç»éªŒå›æ”¾çš„ä¸Šä¸‹æ–‡å­¦ä¹ 
2. **Prompt Strategy**: æç¤ºç­–ç•¥æ–¹æ³•
3. **Baseline**: æ— æŒç»­å­¦ä¹ çš„åŸºçº¿

å®éªŒå®Œæˆåï¼Œä½¿ç”¨å¯¹æ¯”è„šæœ¬ï¼š

```bash
python scripts/compare_experiments.py \
    experiments/icl_er_sequential \
    experiments/prompt_strategy_sequential \
    experiments/baseline
```

**ä¼šç”Ÿæˆï¼š**
- å¯¹æ¯”è¡¨æ ¼ï¼ˆåœ¨ç»ˆç«¯è¾“å‡ºï¼‰
- å¯¹æ¯”å›¾è¡¨ï¼ˆä¿å­˜åœ¨ `experiments/comparison/`ï¼‰
- CSVæ•°æ®ï¼ˆç”¨äºè¿›ä¸€æ­¥åˆ†æï¼‰

---

## ğŸ“Š æŸ¥çœ‹å’Œç†è§£ç»“æœ

### 1. å‡†ç¡®ç‡æ›²çº¿
æŸ¥çœ‹ `experiments/your_experiment/metrics/accuracy_curve.png`

- **Xè½´**: è®­ç»ƒæ­¥éª¤
- **Yè½´**: å‡†ç¡®ç‡
- **å«ä¹‰**: å­¦ä¹ æ›²çº¿ï¼Œç†æƒ³æƒ…å†µä¸‹åº”è¯¥ä¸Šå‡æˆ–ä¿æŒç¨³å®š

### 2. é—å¿˜çŸ©é˜µ
æŸ¥çœ‹ `experiments/your_experiment/metrics/forgetting_matrix.png`

- æ˜¾ç¤ºäº†åœ¨å­¦ä¹ æ–°ä»»åŠ¡åï¼Œå¯¹æ—§ä»»åŠ¡æ€§èƒ½çš„ä¸‹é™æƒ…å†µ
- é¢œè‰²è¶Šæ·±è¡¨ç¤ºé—å¿˜è¶Šä¸¥é‡
- **ç†æƒ³æƒ…å†µ**: çŸ©é˜µåº”è¯¥å¾ˆæµ…ï¼ˆé—å¿˜å°‘ï¼‰

### 3. æ€§èƒ½çŸ©é˜µ
æŸ¥çœ‹ `experiments/your_experiment/metrics/performance_matrix.png`

- è¡Œï¼šåœ¨å“ªä¸ªæ—¶é—´ç‚¹æµ‹è¯•
- åˆ—ï¼šæµ‹è¯•å“ªä¸ªdomain
- æ˜¾ç¤ºäº†åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­å¯¹å„ä¸ªdomainçš„æ€§èƒ½å˜åŒ–

### 4. å…³é”®æŒ‡æ ‡è§£è¯»

```json
{
  "average_accuracy": 0.847,      // å¹³å‡å‡†ç¡®ç‡ï¼Œè¶Šé«˜è¶Šå¥½
  "forgetting_rate": 0.123,       // é—å¿˜ç‡ï¼Œè¶Šä½è¶Šå¥½
  "forward_transfer": 0.056,      // æ­£å‘è¿ç§»ï¼Œè¶Šé«˜è¶Šå¥½ï¼ˆå­¦ä¹ æ–°ä»»åŠ¡å¸®åŠ©æå‡æ—§ä»»åŠ¡ï¼‰
  "backward_transfer": -0.089     // è´Ÿå‘è¿ç§»ï¼Œè¶Šæ¥è¿‘0è¶Šå¥½ï¼ˆå­¦ä¹ æ–°ä»»åŠ¡å¯¹æ—§ä»»åŠ¡çš„å½±å“ï¼‰
}
```

---

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

### åœºæ™¯ï¼šåœ¨ airline å’Œ retail ä¸¤ä¸ªé¢†åŸŸä¸Šè®­ç»ƒå¹¶å¯¹æ¯”æ–¹æ³•

```bash
#!/bin/bash

echo "=== ç¬¬1æ­¥ï¼šéªŒè¯æ•°æ® ==="
tau2 cl-validate-data data/tau2/domains/

echo "=== ç¬¬2æ­¥ï¼šç”Ÿæˆæ•°æ®åˆ’åˆ† ==="
tau2 cl-generate-splits \
    --domains airline retail \
    --strategy sequential \
    --train-ratio 0.7 \
    --num-phases 3

echo "=== ç¬¬3æ­¥ï¼šè¿è¡ŒICL-ERå®éªŒ ==="
tau2 cl-run \
    --name icl_er_exp \
    --domains airline retail \
    --curriculum sequential \
    --agent-type icl_er \
    --agent-llm gpt-4o-mini \
    --user-llm gpt-4o-mini \
    --num-tasks 50 \
    --eval-frequency 10 \
    --output-dir ./experiments/icl_er_exp

echo "=== ç¬¬4æ­¥ï¼šè¿è¡ŒBaselineå¯¹æ¯” ==="
tau2 cl-run \
    --name baseline_exp \
    --domains airline retail \
    --curriculum sequential \
    --agent-type baseline \
    --agent-llm gpt-4o-mini \
    --user-llm gpt-4o-mini \
    --num-tasks 50 \
    --eval-frequency 10 \
    --output-dir ./experiments/baseline_exp

echo "=== ç¬¬5æ­¥ï¼šåˆ†æå’Œå¯¹æ¯” ==="
tau2 cl-analyze experiments/icl_er_exp/results.json
tau2 cl-analyze experiments/baseline_exp/results.json

python scripts/compare_experiments.py \
    experiments/icl_er_exp \
    experiments/baseline_exp

echo "=== å®Œæˆï¼ç»“æœä¿å­˜åœ¨ experiments/ ç›®å½• ==="
```

ä¿å­˜ä¸º `run_my_experiment.sh` å¹¶è¿è¡Œï¼š
```bash
bash run_my_experiment.sh
```

---

## ğŸ› å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### Q1: å‘½ä»¤æ‰¾ä¸åˆ° `tau2`

```bash
# ç¡®ä¿æ­£ç¡®å®‰è£…
pip install -e .

# æˆ–è€…ç›´æ¥ç”¨ python è¿è¡Œ
python -m tau2.cli cl-run --help
```

### Q2: å®éªŒè¿è¡Œå¾ˆæ…¢

```bash
# ä½¿ç”¨æ›´å¿«çš„æ¨¡å‹
--agent-llm gpt-4o-mini --user-llm gpt-4o-mini

# å‡å°‘ä»»åŠ¡æ•°é‡
--num-tasks 20

# é™ä½è¯„ä¼°é¢‘ç‡
--eval-frequency 20
```

### Q3: æ•°æ®ä¸è¶³æ€ä¹ˆåŠï¼Ÿ

å¦‚æœç°æœ‰ä»»åŠ¡æ•°æ®ä¸å¤Ÿï¼Œå¯ä»¥ï¼š

```bash
# æ–¹æ³•1ï¼šç”Ÿæˆä»»åŠ¡æ¨¡æ¿
python scripts/quick_experiment.py generate --domain airline --num-tasks 50

# æ–¹æ³•2ï¼šä½¿ç”¨æ›´å°‘çš„ä»»åŠ¡
--num-tasks 20  # è°ƒæ•´ä¸ºç°æœ‰æ•°æ®é‡
```

### Q4: å¦‚ä½•æŸ¥çœ‹å®éªŒè¿›åº¦ï¼Ÿ

å®éªŒè¿è¡Œæ—¶ä¼šå®æ—¶è¾“å‡ºæ—¥å¿—ã€‚ä½ ä¹Ÿå¯ä»¥æŸ¥çœ‹ï¼š
```bash
# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
tail -f experiments/your_experiment/logs/experiment.log

# æŸ¥çœ‹å·²å®Œæˆçš„æ£€æŸ¥ç‚¹
cat experiments/your_experiment/results.json | grep checkpoint
```

### Q5: æƒ³ç”¨é…ç½®æ–‡ä»¶è€Œä¸æ˜¯å‘½ä»¤è¡Œå‚æ•°

åˆ›å»º `configs/cl_experiments/my_config.yaml`:

```yaml
name: "my_experiment"
seed: 42
output_dir: "./experiments/my_experiment"

curriculum_strategy: "SEQUENTIAL"
domains: ["airline", "retail"]
num_tasks_per_domain: 50

agent_type: "ICL_ER"
agent_llm: "gpt-4o-mini"
max_examples_in_prompt: 5

memory_buffer_size: 1000
user_llm: "gpt-4o-mini"
eval_frequency: 10
```

ç„¶åè¿è¡Œï¼š
```bash
tau2 cl-run --config configs/cl_experiments/my_config.yaml
```

---

## ğŸ“ å­¦ä¹ è·¯å¾„æ¨è

### åˆå­¦è€…è·¯å¾„ï¼ˆä¼°è®¡æ—¶é—´ï¼š1å°æ—¶ï¼‰
1. âœ… è¿è¡Œ `quick-test`ï¼ˆ10åˆ†é’Ÿï¼‰
2. âœ… ç†è§£è¾“å‡ºç»“æœï¼ˆ10åˆ†é’Ÿï¼‰
3. âœ… æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡å®Œæ•´å®éªŒï¼ˆ30åˆ†é’Ÿï¼‰
4. âœ… æŸ¥çœ‹å’Œç†è§£å¯è§†åŒ–å›¾è¡¨ï¼ˆ10åˆ†é’Ÿï¼‰

### è¿›é˜¶ç”¨æˆ·è·¯å¾„ï¼ˆä¼°è®¡æ—¶é—´ï¼š2-3å°æ—¶ï¼‰
1. âœ… åœ¨å¤šä¸ªdomainä¸Šè¿è¡Œå®éªŒï¼ˆ30åˆ†é’Ÿï¼‰
2. âœ… å¯¹æ¯”ä¸åŒçš„æ–¹æ³•ï¼ˆICL-ER vs Baselineï¼‰ï¼ˆ1å°æ—¶ï¼‰
3. âœ… å°è¯•ä¸åŒçš„curriculumç­–ç•¥ï¼ˆsequential vs interleavedï¼‰ï¼ˆ1å°æ—¶ï¼‰
4. âœ… åˆ†æå’Œè§£é‡Šç»“æœï¼ˆ30åˆ†é’Ÿï¼‰

### é«˜çº§ç”¨æˆ·è·¯å¾„ï¼ˆä¼°è®¡æ—¶é—´ï¼š1å¤©ï¼‰
1. âœ… ç”Ÿæˆæ–°çš„è®­ç»ƒæ•°æ®
2. âœ… å®ç°è‡ªå®šä¹‰çš„Agentç­–ç•¥
3. âœ… è¿è¡Œå®Œæ•´çš„å¯¹æ¯”å®éªŒ
4. âœ… æ’°å†™å®éªŒæŠ¥å‘Šå’Œè®ºæ–‡

---

## ğŸ“š ä¸‹ä¸€æ­¥

å®Œæˆå®éªŒåï¼Œä½ å¯ä»¥ï¼š

1. **æŸ¥çœ‹è¯¦ç»†è®¾è®¡æ–‡æ¡£**:
   - `docs/continuous_learning_framework_design.md`

2. **æŸ¥çœ‹APIæ–‡æ¡£**:
   - `src/tau2/continual_learning/README.md`

3. **è´¡çŒ®ä½ çš„æ–¹æ³•**:
   - åœ¨ `src/tau2/continual_learning/agents/` å®ç°æ–°çš„agent
   - åœ¨ `src/tau2/continual_learning/curriculum/` å®ç°æ–°çš„curriculumç­–ç•¥

4. **æŠ¥å‘Šé—®é¢˜**:
   - åœ¨ GitHub Issues ä¸­æŠ¥å‘Šbugæˆ–æå‡ºå»ºè®®

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å§‹ç»ˆå…ˆç”¨å°æ•°æ®é›†æµ‹è¯•**ï¼ˆ--num-tasks 10-20ï¼‰
2. **å¤šæ¬¡è¿è¡Œå®éªŒ**ï¼Œä½¿ç”¨ä¸åŒçš„seedï¼ˆ--seed 42, 43, 44...ï¼‰
3. **ä¿å­˜ä¸­é—´ç»“æœ**ï¼Œå®éªŒä¼šè‡ªåŠ¨ä¿å­˜æ£€æŸ¥ç‚¹
4. **å¯¹æ¯”baseline**ï¼Œå§‹ç»ˆåŒ…å«æ— CLçš„baselineå¯¹æ¯”
5. **è®°å½•å®éªŒé…ç½®**ï¼Œä¿å­˜å¥½configæ–‡ä»¶

---

## ğŸ‰ å¼€å§‹ä½ çš„ç¬¬ä¸€ä¸ªå®éªŒå§ï¼

æœ€ç®€å•çš„å¼€å§‹æ–¹å¼ï¼š

```bash
# ä¸€è¡Œå‘½ä»¤ï¼Œ5åˆ†é’Ÿå®Œæˆ
python scripts/quick_experiment.py quick-test --domain airline --num-tasks 10
```

ç¥å®éªŒé¡ºåˆ©ï¼ğŸš€
